<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Humor Translator: Pro</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --accent: #3b82f6;
      --esfp: #f97316;   /* Kevin Hart */
      --infp: #8b5cf6;   /* Louis CK */
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --border: #334155;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .container { width: 100%; max-width: 900px; }

    header { text-align: center; margin-bottom: 30px; }
    h1 { color: var(--accent); margin: 0; font-size: 2.2rem; letter-spacing: -1px; }
    .subtitle { color: var(--muted); font-size: 1.1rem; margin-top: 10px; font-weight: 500; }

    /* Navigation */
    .nav {
      display: flex;
      background: var(--card);
      padding: 5px;
      border-radius: 12px;
      margin-bottom: 25px;
      gap: 5px;
    }
    .nav-btn {
      flex: 1;
      padding: 14px;
      background: transparent;
      border: none;
      color: var(--muted);
      font-weight: 600;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 0.95rem;
    }
    .nav-btn.active { background: var(--accent); color: white; }
    .nav-btn:hover:not(.active) { background: rgba(255,255,255,0.05); color: var(--text); }

    /* Layout */
    .section { display: none; animation: fadeIn 0.4s ease; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
    }

    h2 { margin-top: 0; font-size: 1.5rem; }
    p { line-height: 1.6; color: #cbd5e1; }

    /* Diagnosis Tab Elements */
    .case-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }
    .badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      text-transform: uppercase;
    }

    .phrase-box {
      background: rgba(0,0,0,0.3);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border-left: 5px solid var(--muted);
    }
    
    .options-grid { display: grid; gap: 12px; grid-template-columns: 1fr; margin-top: 20px; }
    .option-btn {
      padding: 18px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      cursor: pointer;
      text-align: left;
      font-size: 1rem;
      transition: all 0.2s;
      position: relative;
    }
    .option-btn:hover { border-color: var(--accent); background: rgba(59, 130, 246, 0.1); }
    .option-btn.correct { border-color: var(--success); background: rgba(16, 185, 129, 0.15); }
    .option-btn.wrong { border-color: var(--danger); background: rgba(239, 68, 68, 0.15); }

    .feedback {
      margin-top: 20px;
      padding: 20px;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      display: none;
      animation: fadeIn 0.3s;
    }

    /* Lab Elements */
    .lab-controls { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin: 25px 0; }
    .control-group h4 { margin: 0 0 12px; color: var(--muted); text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
    
    .toggle-btn {
      display: block;
      width: 100%;
      padding: 12px;
      margin-bottom: 8px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      border-radius: 8px;
      cursor: pointer;
      text-align: left;
    }
    .toggle-btn.selected { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 0 10px rgba(59,130,246,0.3); }

    .console {
      background: #0d1117;
      border: 1px solid #30363d;
      font-family: 'Consolas', 'Courier New', monospace;
      padding: 20px;
      border-radius: 10px;
      color: var(--success);
      min-height: 120px;
      margin-top: 25px;
      white-space: pre-wrap;
      line-height: 1.5;
      font-size: 0.95rem;
    }

    .btn-action {
      width: 100%;
      padding: 16px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 800;
      font-size: 1.1rem;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .btn-action:active { transform: scale(0.98); }
    .btn-next { background: rgba(255,255,255,0.1); margin-top: 20px; display: none; }

  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>AI Humor Translator</h1>
    <div class="subtitle">Advanced Stylistic Training & Persona Preservation</div>
  </header>

  <nav class="nav">
    <button class="nav-btn active" onclick="app.showTab('theory')">1. –¢–µ–æ—Ä–∏—è –õ–∏—á–Ω–æ—Å—Ç–∏</button>
    <button class="nav-btn" onclick="app.showTab('diagnosis')">2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (Quiz)</button>
    <button class="nav-btn" onclick="app.showTab('lab')">3. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è (Sim)</button>
  </nav>

  <section id="theory" class="section active">
    <div class="card">
      <h2>–ü—Å–∏—Ö–æ–ª–∏–Ω–≥–≤–∏—Å—Ç–∏–∫–∞ –≤ –ø–µ—Ä–µ–≤–æ–¥–µ</h2>
      <p>–ü—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ–≤–æ–¥ –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–º—ã—Å–ª, –Ω–æ —á–∞—Å—Ç–æ —É–±–∏–≤–∞–µ—Ç ¬´–≥–æ–ª–æ—Å¬ª –∞–≤—Ç–æ—Ä–∞. –ß—Ç–æ–±—ã —Å—Ç–µ–Ω–¥–∞–ø –∑–≤—É—á–∞–ª –∂–∏–≤–æ, –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ (–∏–ª–∏ –ò–ò) –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Å–∏—Ö–æ—Ç–∏–ø –∫–æ–º–∏–∫–∞ (MBTI).</p>
      
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:20px;">
        <div style="background:rgba(249, 115, 22, 0.1); padding:20px; border-radius:12px; border:1px solid var(--esfp);">
          <h3 style="color:var(--esfp); margin:0;">Kevin Hart (ESFP)</h3>
          <p style="font-size:0.9rem;"><strong>–ú–∞—Ä–∫–µ—Ä—ã:</strong> –ì–∏–ø–µ—Ä–±–æ–ª–∞, –∫–∞–ø—Å, –≤–æ—Å–∫–ª–∏—Ü–∞–Ω–∏—è, –ø–æ–≤—Ç–æ—Ä—ã, –≥—Ä—É–±—ã–π —Å–ª–µ–Ω–≥, —ç–Ω–µ—Ä–≥–∏—è.</p>
          <p style="font-size:0.9rem;"><strong>–ì–ª–∞–≤–Ω–∞—è –æ—à–∏–±–∫–∞ –ò–ò:</strong> –ü–æ—Ç–µ—Ä—è —ç–Ω–µ—Ä–≥–∏–∏. –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ ¬´–∫—Ä–∏–∫–∞¬ª –≤ —Å–ø–æ–∫–æ–π–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.</p>
        </div>
        <div style="background:rgba(139, 92, 246, 0.1); padding:20px; border-radius:12px; border:1px solid var(--infp);">
          <h3 style="color:var(--infp); margin:0;">Louis C.K. (INFP)</h3>
          <p style="font-size:0.9rem;"><strong>–ú–∞—Ä–∫–µ—Ä—ã:</strong> –°–ª–æ–∂–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —Å–∞–º–æ—É–Ω–∏—á–∏–∂–µ–Ω–∏–µ, —Ü–∏–Ω–∏–∑–º, ¬´–≥—Ä—É—Å—Ç–Ω–∞—è¬ª –≥—Ä—É–±–æ—Å—Ç—å.</p>
          <p style="font-size:0.9rem;"><strong>–ì–ª–∞–≤–Ω–∞—è –æ—à–∏–±–∫–∞ –ò–ò:</strong> –ü–æ—Ç–µ—Ä—è –∏—Ä–æ–Ω–∏–∏. –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ —Ç–æ–Ω–∫–æ–π —à—É—Ç–∫–∏ –≤ –ø—Ä–æ—Å—Ç–æ–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ.</p>
        </div>
      </div>
      <br>
      <button class="btn-action" onclick="app.showTab('diagnosis')">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–∞–∫—Ç–∏–∫–µ ‚Üí</button>
    </div>
  </section>

  <section id="diagnosis" class="section">
    <div class="card">
      <div class="case-header">
        <h2>–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –ò–ò</h2>
        <span id="q-counter" class="badge" style="background:rgba(255,255,255,0.1);">Case 1/5</span>
      </div>
      <p>–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–æ—Ç–µ—Ä—è–ª–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ (Style Loss).</p>
      
      <div id="quiz-content"></div> <div id="quiz-feedback" class="feedback"></div>
      <button id="quiz-next-btn" class="btn-action btn-next" onclick="app.nextQuestion()">–°–ª–µ–¥—É—é—â–∏–π –∫–µ–π—Å</button>
    </div>
  </section>

  <section id="lab" class="section">
    <div class="card">
      <h2>–ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥</h2>
      <p>–ò–ò –≤—ã–¥–∞–ª ¬´–ø–ª–æ—Ö–æ–π¬ª –ø–µ—Ä–µ–≤–æ–¥. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–º–ø—Ç–∞ (–ü–µ—Ä—Å–æ–Ω–∞ + –°—Ç—Ä–∞—Ç–µ–≥–∏—è), —á—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ.</p>

      <div id="lab-scenario" class="phrase-box" style="border-color: var(--accent);">
        </div>

      <div class="lab-controls">
        <div class="control-group">
          <h4>1. –ü—Ä–æ—Ñ–∏–ª—å –õ–∏—á–Ω–æ—Å—Ç–∏ (Persona)</h4>
          <button class="toggle-btn" onclick="app.setPrompt('p', 'generic', this)">ü§ñ Generic (–ë–µ–∑ –ª–∏—á–Ω–æ—Å—Ç–∏)</button>
          <button class="toggle-btn" onclick="app.setPrompt('p', 'esfp', this)">üî• ESFP (Energy/Hart)</button>
          <button class="toggle-btn" onclick="app.setPrompt('p', 'infp', this)">üåÄ INFP (Cynical/Louis)</button>
        </div>
        <div class="control-group">
          <h4>2. –°—Ç—Ä–∞—Ç–µ–≥–∏—è (Strategy)</h4>
          <button class="toggle-btn" onclick="app.setPrompt('s', 'soft', this)">üõ°Ô∏è Euphemistic (–°–º—è–≥—á–µ–Ω–∏–µ)</button>
          <button class="toggle-btn" onclick="app.setPrompt('s', 'raw', this)">‚öîÔ∏è Direct/Adaptive (–•–∞—Ä–¥–∫–æ—Ä)</button>
        </div>
      </div>

      <button class="btn-action" onclick="app.runSimulation()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥</button>
      <div id="lab-console" class="console" style="display:none;"></div>
      <button id="lab-next-btn" class="btn-action btn-next" onclick="app.nextLab()">–°–ª–µ–¥—É—é—â–∞—è —Ñ—Ä–∞–∑–∞</button>
    </div>
  </section>

</div>

<script>
/**
 * –ë–ê–ó–ê –î–ê–ù–ù–´–•
 */
const DATABASE = {
  // –î–∞–Ω–Ω—ã–µ –¥–ª—è –ö–≤–∏–∑–∞ (–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
  quiz: [
    {
      author: "Kevin Hart",
      type: "ESFP",
      source: "Cold as sh* out this bitch.", 
      translation: "–ù–∞ —É–ª–∏—Ü–µ —Ö–æ–ª–æ–¥–Ω–æ –∫–∞–∫ –≤ –º–æ—Ä–æ–∑–∏–ª–∫–µ.", // YandexGPT
      loss: "Energy Loss",
      options: [
        { text: "–°–º—ã—Å–ª –ø–µ—Ä–µ–¥–∞–Ω –≤–µ—Ä–Ω–æ, –ø–æ—Ç–µ—Ä—å –Ω–µ—Ç", correct: false },
        { text: "–ü–æ—Ç–µ—Ä—è–Ω–∞ —ç–∫—Å–ø—Ä–µ—Å—Å–∏—è –∏ –≥—Ä—É–±–æ—Å—Ç—å (Euphemistic)", correct: true },
        { text: "–ì—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞", correct: false }
      ],
      info: "YandexGPT –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å—Ç—Ä–∞—Ç–µ–≥–∏—é Euphemistic. –î–ª—è ESFP —Ç–∏–ø–∞ —ç—Ç–æ —Ñ–∞—Ç–∞–ª—å–Ω–æ ‚Äî —Ç–µ—Ä—è–µ—Ç—Å—è –≤–µ—Å—å '–¥—Ä–∞–π–≤' –∫–æ–º–∏–∫–∞."
    },
    {
      author: "Louis C.K.",
      type: "INFP",
      source: "I gotta see the f***ing face of the piece of sh**...", 
      translation: "–Ø –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å —ç—Ç—É –µ**—á—É—é —Ä–æ–∂—É —Ç–æ–≥–æ –∫—É—Å–∫–∞ –¥*—Ä—å–º–∞...", // Gemini
      loss: "None (Good Direct)",
      options: [
        { text: "–°–ª–∏—à–∫–æ–º –≥—Ä—É–±–æ, –Ω—É–∂–Ω–æ –±—ã–ª–æ —Å–º—è–≥—á–∏—Ç—å", correct: false },
        { text: "–ü–µ—Ä–µ–≤–æ–¥ —Ç–æ—á–Ω—ã–π, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è Direct (–£—Å–ø–µ—Ö)", correct: true },
        { text: "–ü–æ—Ç–µ—Ä—è–Ω–∞ –∏—Ä–æ–Ω–∏—è", correct: false }
      ],
      info: "Gemini —Å–æ—Ö—Ä–∞–Ω–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ª–µ–∫—Å–∏–∫—É (Direct Strategy). –î–ª—è INFP —ç—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç, —Ç–∞–∫ –∫–∞–∫ –ø–µ—Ä–µ–¥–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∑–ª–æ—Å—Ç—å."
    },
    {
      author: "Kevin Hart",
      type: "ESFP",
      source: "Get your ass out of the damn oven!",
      translation: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–ª–µ–∑–∞–π –∏–∑ –¥—É—Ö–æ–≤–∫–∏.", // Copilot
      loss: "Tone Loss",
      options: [
        { text: "–ü–æ—Ç–µ—Ä—è–Ω–∞ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å (–ø—Ä–∏–∫–∞–∑–Ω–æ–π —Ç–æ–Ω)", correct: true },
        { text: "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–ª–µ–Ω–≥–∞", correct: false },
        { text: "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —Å–ª–æ–≤–∞ oven", correct: false }
      ],
      info: "–°–ª–æ–≤–æ '–ø–æ–∂–∞–ª—É–π—Å—Ç–∞' —É–±–∏–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ö–µ–≤–∏–Ω–∞ –•–∞—Ä—Ç–∞. Copilot —á–∞—Å—Ç–æ —Å—Ç—Ä–∞–¥–∞–µ—Ç –∏–∑–ª–∏—à–Ω–µ–π –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å—é."
    },
    {
      author: "Louis C.K.",
      type: "INFP",
      source: "You go to the zoo, you fat b****", 
      translation: "–¢—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å—Å—è –≤ –∑–æ–æ–ø–∞—Ä–∫, –º–∏–ª—ã–π, –Ω–æ —Ç–µ–±–µ –±—É–¥–µ—Ç –Ω–µ–∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ...", // YandexGPT5
      loss: "Total Change",
      options: [
        { text: "–ü–æ–ª–Ω–∞—è —Å–º–µ–Ω–∞ –∏–Ω—Ç–µ–Ω—Ü–∏–∏ (Euphemistic)", correct: true },
        { text: "–•–æ—Ä–æ—à–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (Adaptive)", correct: false },
        { text: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≥—Ä—É–±–æ—Å—Ç—å", correct: false }
      ],
      info: "–ò–ò –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ –≤ –∑–∞–±–æ—Ç—É. –≠—Ç–æ –ø–æ–ª–Ω–∞—è –ø–æ—Ç–µ—Ä—è –ª–∏—á–Ω–æ—Å—Ç–∏ (Persona Loss)."
    }
  ],

  // –î–∞–Ω–Ω—ã–µ –¥–ª—è –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ (–°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤)
  lab: [
    {
      id: 1,
      author: "Kevin Hart",
      persona: "esfp",
      source: "I don't get mad as I used to... I did a lot of stupid sh** as a child.",
      variants: {
        soft: "–Ø —Å—Ç–∞–ª —Å–ø–æ–∫–æ–π–Ω–µ–µ. –í –¥–µ—Ç—Å—Ç–≤–µ —è —á–∞—Å—Ç–æ —Å–æ–≤–µ—Ä—à–∞–ª –æ—à–∏–±–∫–∏. (–°–∫—É—á–Ω–æ)",
        generic: "–Ø –Ω–µ –∑–ª—é—Å—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ. –Ø –¥–µ–ª–∞–ª –º–Ω–æ–≥–æ –¥–µ—Ä—å–º–∞ —Ä–µ–±–µ–Ω–∫–æ–º. (–°—É—Ö–æ)",
        ideal: "–Ø –£–ñ–ï –ù–ï –¢–ê–ö –ü–°–ò–•–£–Æ, –ö–ê–ö –†–ê–ù–¨–®–ï... –ù–û –í –î–ï–¢–°–¢–í–ï –Ø –¢–í–û–†–ò–õ –ü–û–õ–ù–£–Æ –•–ï–†–ù–Æ! (ESFP Style!)"
      }
    },
    {
      id: 2,
      author: "Louis C.K.",
      persona: "infp",
      source: "Yeah, ‚Äòcause you‚Äôre f***ing fat, someone shot you in the f***ing head ‚Äòcause you‚Äôre fat.", 
      variants: {
        soft: "–¢–∞–∫ –∫–∞–∫ —É —Ç–µ–±—è –ª–∏—à–Ω–∏–π –≤–µ—Å, –≤ —Ç–µ–±—è —Å—Ç—Ä–µ–ª—è–ª–∏. (–¶–µ–Ω–∑—É—Ä–∞)",
        generic: "–¢—ã –∂–∏—Ä–Ω—ã–π, –ø–æ—ç—Ç–æ–º—É —Ç–µ–±–µ –≤—ã—Å—Ç—Ä–µ–ª–∏–ª–∏ –≤ –≥–æ–ª–æ–≤—É. (–ë–µ–∑ —ç–º–æ—Ü–∏–π)",
        ideal: "–î–∞, —Ç—ã –ø—Ä–æ—Å—Ç–æ –∂–∏—Ä–Ω—ã–π —É–±–ª—é–¥–æ–∫, –≤–æ—Ç —Ç–µ–±–µ –∏ –ø—Ä–æ—Å—Ç—Ä–µ–ª–∏–ª–∏ –±–∞—à–∫—É, —Ç—É–ø–æ –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã –∂–∏—Ä–Ω—ã–π. (INFP Cynicism)"
      }
    },
    {
      id: 3,
      author: "Kevin Hart",
      persona: "esfp",
      source: "Everybody was doing the same dumb s*** every person at the same stupid f***ing moment!", 
      variants: {
        soft: "–í—Å–µ –≤–µ–ª–∏ —Å–µ–±—è –≥–ª—É–ø–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. (Yandex style)",
        generic: "–í—Å–µ –¥–µ–ª–∞–ª–∏ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Ç—É–ø–æ–µ –¥–µ—Ä—å–º–æ –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç.",
        ideal: "–í–°–ï, –ë–õ–ò–ù, –¢–í–û–†–ò–õ–ò –û–î–ù–£ –ò –¢–£ –ñ–ï –•–†–ï–ù–¨! –ö–ê–ñ–î–´–ô, –ú–ê–¢–¨ –ï–ì–û, –í –û–î–ù–£ –ò –¢–£ –ñ–ï –°–ï–ö–£–ù–î–£! (Adaptive/Expressive)"
      }
    }
  ]
};

/**
 * –ü–†–ò–õ–û–ñ–ï–ù–ò–ï
 */
const app = {
  state: {
    qIndex: 0,
    labIndex: 0,
    prompt: { p: null, s: null }
  },

  init: function() {
    this.renderQuestion();
    this.renderLab();
  },

  showTab: function(id) {
    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    
    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    const navMap = {'theory':0, 'diagnosis':1, 'lab':2};
    document.querySelectorAll('.nav-btn')[navMap[id]].classList.add('active');
  },

  // --- –õ–û–ì–ò–ö–ê –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ---
  renderQuestion: function() {
    const data = DATABASE.quiz[this.state.qIndex];
    const container = document.getElementById('quiz-content');
    const counter = document.getElementById('q-counter');
    const feedback = document.getElementById('quiz-feedback');
    const nextBtn = document.getElementById('quiz-next-btn');

    counter.textContent = `Case ${this.state.qIndex + 1}/${DATABASE.quiz.length}`;
    feedback.style.display = 'none';
    nextBtn.style.display = 'none';

    // –¶–≤–µ—Ç —Ä–∞–º–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–≤—Ç–æ—Ä–∞
    const color = data.type === 'ESFP' ? 'var(--esfp)' : 'var(--infp)';
    
    let html = `
      <div class="phrase-box" style="border-left-color: ${color}">
        <div style="color:${color}; font-weight:bold; margin-bottom:5px;">${data.author} (${data.type})</div>
        <div style="font-size:1.1rem; margin-bottom:10px;">"${data.source}"</div>
        <div style="background:rgba(255,255,255,0.1); padding:10px; border-radius:8px;">
          <strong>AI –ü–µ—Ä–µ–≤–æ–¥:</strong> "${data.translation}"
        </div>
      </div>
      <div class="options-grid">
    `;

    data.options.forEach((opt, idx) => {
      html += `<button class="option-btn" onclick="app.checkQuiz(${idx}, this)">${opt.text}</button>`;
    });
    html += `</div>`;
    
    container.innerHTML = html;
  },

  checkQuiz: function(idx, btn) {
    const data = DATABASE.quiz[this.state.qIndex];
    const feedback = document.getElementById('quiz-feedback');
    const nextBtn = document.getElementById('quiz-next-btn');
    const buttons = document.querySelectorAll('.options-grid .option-btn');

    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
    buttons.forEach(b => b.disabled = true);

    if (data.options[idx].correct) {
      btn.classList.add('correct');
      feedback.className = 'feedback'; 
      feedback.style.borderLeft = '4px solid var(--success)';
      feedback.innerHTML = `<strong style="color:var(--success)">–í–µ—Ä–Ω–æ!</strong><br>${data.info}`;
    } else {
      btn.classList.add('wrong');
      feedback.className = 'feedback';
      feedback.style.borderLeft = '4px solid var(--danger)';
      feedback.innerHTML = `<strong style="color:var(--danger)">–û—à–∏–±–∫–∞.</strong><br>${data.info}`;
      // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
      data.options.forEach((opt, i) => { if(opt.correct) buttons[i].classList.add('correct'); });
    }
    feedback.style.display = 'block';
    nextBtn.style.display = 'block';
  },

  nextQuestion: function() {
    this.state.qIndex = (this.state.qIndex + 1) % DATABASE.quiz.length;
    this.renderQuestion();
  },

  // --- –õ–û–ì–ò–ö–ê –õ–ê–ë–û–†–ê–¢–û–†–ò–ò ---
  renderLab: function() {
    const data = DATABASE.lab[this.state.labIndex];
    const container = document.getElementById('lab-scenario');
    const consoleDiv = document.getElementById('lab-console');
    const nextBtn = document.getElementById('lab-next-btn');

    consoleDiv.style.display = 'none';
    nextBtn.style.display = 'none';
    this.state.prompt = { p: null, s: null }; // —Å–±—Ä–æ—Å

    // –°–±—Ä–æ—Å –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('selected'));

    const color = data.persona === 'esfp' ? 'var(--esfp)' : 'var(--infp)';

    container.innerHTML = `
      <div style="display:flex; justify-content:space-between;">
        <span style="color:${color}; font-weight:bold;">${data.author}</span>
        <span style="color:var(--muted); font-size:0.8rem;">ID: ${data.id}</span>
      </div>
      <div style="font-size:1.2rem; margin-top:10px; font-style:italic;">"${data.source}"</div>
    `;
    container.style.borderLeftColor = color;
  },

  setPrompt: function(type, val, btn) {
    this.state.prompt[type] = val;
    // –í–∏–∑—É–∞–ª
    const parent = btn.parentElement;
    parent.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
  },

  runSimulation: function() {
    const consoleDiv = document.getElementById('lab-console');
    const nextBtn = document.getElementById('lab-next-btn');
    const data = DATABASE.lab[this.state.labIndex];
    const p = this.state.prompt.p;
    const s = this.state.prompt.s;

    consoleDiv.style.display = 'block';
    consoleDiv.innerHTML = '> AI processing...';

    setTimeout(() => {
      if (!p || !s) {
        consoleDiv.style.color = 'var(--warning)';
        consoleDiv.innerHTML = '> –û–®–ò–ë–ö–ê: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –∑–∞–¥–∞–Ω—ã. –í—ã–±–µ—Ä–∏—Ç–µ –ü–µ—Ä—Å–æ–Ω—É –∏ –°—Ç—Ä–∞—Ç–µ–≥–∏—é.';
        return;
      }

      let resultText = "";
      let verdict = "";
      let isSuccess = false;

      // –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏–∑ –±–∞–∑—ã
      if (s === 'soft') {
        resultText = data.variants.soft;
        verdict = "FAIL. –í—ã –≤—ã–±—Ä–∞–ª–∏ '–°–º—è–≥—á–µ–Ω–∏–µ'. –°—Ç–∏–ª—å –∫–æ–º–∏–∫–∞ –ø–æ—Ç–µ—Ä—è–Ω.";
        consoleDiv.style.color = 'var(--warning)';
      } else if (p === 'generic') {
        resultText = data.variants.generic;
        verdict = "MEDIOCRE. –ë–µ–∑ –ø—Ä–æ—Ñ–∏–ª—è –ª–∏—á–Ω–æ—Å—Ç–∏ (Persona) –ø–µ—Ä–µ–≤–æ–¥ —Å—É—Ö–æ–π.";
        consoleDiv.style.color = '#cbd5e1';
      } else if (p !== data.persona) {
         // –í—ã–±—Ä–∞–ª–∏ –Ω–µ —Ç—É –ø–µ—Ä—Å–æ–Ω—É (–Ω–∞–ø—Ä. ESFP –¥–ª—è –õ—É–∏ –°–∏ –ö–µ—è)
         resultText = "¬´–≠–ô! –Ø –¢–£–¢ –ì–†–£–©–£, –ß–ï–†–¢ –í–û–ó–¨–ú–ò!¬ª (–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–Ω)";
         verdict = "MISMATCH. –í—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å " + p.toUpperCase() + " –∫ –∞–≤—Ç–æ—Ä—É " + data.persona.toUpperCase() + ".";
         consoleDiv.style.color = 'var(--danger)';
      } else if (p === data.persona && s === 'raw') {
        // –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        resultText = data.variants.ideal;
        verdict = "SUCCESS! –ü–µ—Ä—Å–æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞. –°—Ç—Ä–∞—Ç–µ–≥–∏—è Direct/Adaptive —Å—Ä–∞–±–æ—Ç–∞–ª–∞.";
        isSuccess = true;
        consoleDiv.style.color = 'var(--success)';
      }

      consoleDiv.innerHTML = `> Prompt: [Persona: ${p.toUpperCase()}] + [Strategy: ${s.toUpperCase()}]\n----------------------------------\nOUTPUT:\n${resultText}\n----------------------------------\nSYSTEM: ${verdict}`;
      
      if (isSuccess) nextBtn.style.display = 'block';
    }, 500);
  },

  nextLab: function() {
    this.state.labIndex = (this.state.labIndex + 1) % DATABASE.lab.length;
    this.renderLab();
  }
};

// –ó–∞–ø—É—Å–∫
document.addEventListener("DOMContentLoaded", () => app.init());

</script>
</body>
</html>